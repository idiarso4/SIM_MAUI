<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:SKANSAPUNG.MAUI.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:models="clr-namespace:SKANSAPUNG.MAUI.Models"
             x:Class="SKANSAPUNG.MAUI.Views.ReportsPage"
             Title="{Binding Title}"
             x:DataType="viewmodels:ReportsViewModel">
    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior EventName="Appearing" Command="{Binding LoadSummaryCommand}" />
    </ContentPage.Behaviors>
    
    <ScrollView>
        <VerticalStackLayout Spacing="10" Padding="15">
            <Label Text="Ringkasan Sekolah" FontSize="Title" FontAttributes="Bold" />

            <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" Gap="10" Margin="0,10">
                <!-- Card Total Siswa -->
                <Frame Grid.Row="0" Grid.Column="0" Style="{StaticResource CardView}">
                    <VerticalStackLayout>
                        <Label Text="Total Siswa" Style="{StaticResource CardTitle}" />
                        <Label Text="{Binding Summary.TotalStudents}" Style="{StaticResource CardData}" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Card Total Guru -->
                <Frame Grid.Row="0" Grid.Column="1" Style="{StaticResource CardView}">
                    <VerticalStackLayout>
                        <Label Text="Total Guru" Style="{StaticResource CardTitle}" />
                        <Label Text="{Binding Summary.TotalTeachers}" Style="{StaticResource CardData}" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Card Total Kelas -->
                <Frame Grid.Row="1" Grid.Column="0" Style="{StaticResource CardView}">
                    <VerticalStackLayout>
                        <Label Text="Total Kelas" Style="{StaticResource CardTitle}" />
                        <Label Text="{Binding Summary.TotalClasses}" Style="{StaticResource CardData}" />
                    </VerticalStackLayout>
                </Frame>

                <!-- Card Absensi Hari Ini -->
                <Frame Grid.Row="1" Grid.Column="1" Style="{StaticResource CardView}">
                    <VerticalStackLayout>
                        <Label Text="Absensi Hari Ini" Style="{StaticResource CardTitle}" />
                        <Label Text="{Binding Summary.AttendanceToday}" Style="{StaticResource CardData}" />
                    </VerticalStackLayout>
                </Frame>
            </Grid>

            <Label Text="Pilih Laporan" FontSize="Title" FontAttributes="Bold" Margin="0,20,0,0" />
            <CollectionView ItemsSource="{Binding AvailableReports}" SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:ReportType">
                        <Frame Style="{StaticResource CardView}" Padding="15" Margin="0,5">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:ReportsViewModel}}, Path=SelectReportAsyncCommand}" CommandParameter="{Binding .}" />
                            </Frame.GestureRecognizers>
                            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15" VerticalOptions="Center">
                                <Image Source="{Binding Icon}" WidthRequest="32" HeightRequest="32" Aspect="AspectFit" />
                                <VerticalStackLayout Grid.Column="1">
                                    <Label Text="{Binding Title}" FontAttributes="Bold" FontSize="Subtitle" />
                                    <Label Text="{Binding Description}" FontSize="Caption" TextColor="Gray" />
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" VerticalOptions="Center" HorizontalOptions="Center" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage> 