<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:SKANSAPUNG.MAUI.ViewModels"
             xmlns:model="clr-namespace:SKANSAPUNG.MAUI.Models"
             x:Class="SKANSAPUNG.MAUI.Views.SchedulePage"
             Title="{Binding Title}"
             x:DataType="viewmodel:ScheduleViewModel">

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior
            EventName="Appearing"
            Command="{Binding InitializeCommand}" />
    </ContentPage.Behaviors>

    <StackLayout Padding="16" Spacing="12">
        <Frame Style="{StaticResource PickerFrameStyle}">
            <Picker ItemsSource="{Binding ClassRooms}"
                    ItemDisplayBinding="{Binding Name}"
                    SelectedItem="{Binding SelectedClassRoom}"
                    Title="Pilih Kelas"
                    IsEnabled="{Binding IsNotBusy}"/>
        </Frame>

        <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Never">
            <StackLayout BindableLayout.ItemsSource="{Binding Days}" Orientation="Horizontal" Spacing="8">
                <BindableLayout.ItemTemplate>
                    <DataTemplate x:DataType="x:String">
                        <Button Text="{Binding .}"
                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:ScheduleViewModel}}, Path=SelectDayCommand}"
                                CommandParameter="{Binding .}">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="BackgroundColor" Value="{StaticResource Gray100}" />
                                    <Setter Property="TextColor" Value="{StaticResource Gray900}" />
                                    <Setter Property="CornerRadius" Value="16" />
                                    <Setter Property="HeightRequest" Value="32" />
                                    <Setter Property="Padding" Value="12,0" />
                                    <Setter Property="FontSize" Value="14" />
                                </Style>
                            </Button.Style>
                            <Button.Triggers>
                                <DataTrigger TargetType="Button"
                                             Binding="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:ScheduleViewModel}}, Path=SelectedDay}"
                                             Value="{Binding .}">
                                    <Setter Property="BackgroundColor" Value="{StaticResource Primary}" />
                                    <Setter Property="TextColor" Value="{StaticResource White}" />
                                    <Setter Property="FontAttributes" Value="Bold" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </StackLayout>
        </ScrollView>
        
        <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" HorizontalOptions="Center" VerticalOptions="Center" />

        <CollectionView ItemsSource="{Binding DailySchedule}" Margin="0,8,0,0">
            <CollectionView.EmptyView>
                <StackLayout VerticalOptions="Center" HorizontalOptions="Center" Padding="20">
                    <Label Text="Tidak ada jadwal untuk hari ini." HorizontalTextAlignment="Center"/>
                </StackLayout>
            </CollectionView.EmptyView>
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="model:ScheduleItem">
                    <Frame Padding="12" Margin="0,0,0,8" CornerRadius="8" BorderColor="{StaticResource Gray200}">
                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                            <Label Grid.Column="0" Text="{Binding FormattedTime}" FontAttributes="Bold" VerticalOptions="Center"/>
                            <StackLayout Grid.Column="1" VerticalOptions="Center">
                                <Label Text="{Binding SubjectName}" FontSize="Medium" FontAttributes="Bold"/>
                                <Label Text="{Binding TeacherName}" IsVisible="{Binding TeacherName, Converter={StaticResource StringNotEmptyConverter}}"/>
                            </StackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </StackLayout>

</ContentPage> 